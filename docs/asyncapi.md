# Verona Interfaces Specification "Editor" 4.0.0 documentation

* License: [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/)
* Support: [Institute for Educational Quality Improvement (IQB)](https://www.iqb.hu-berlin.de)
* Email support: [iqb-tbadev@hu-berlin.de](mailto:iqb-tbadev@hu-berlin.de)

This is one part of the Verona Online Assessment Standards. All messages are sent via the postMessage function of the html page. The editor takes the page root of its parent as target (parent.window), and the application binds the function call to the iframe element of the editor.
Most important, the message body carries as first parameter the operationId of the message.
The html page MUST contain a <script>-tag with metadata. The syntax and structure of this data are described [here](https://github.com/verona-interfaces/metadata/#readme).

## Table of Contents

* [Operations](#operations)
  * [SUB voeReadyNotification](#sub-voereadynotification-operation)
  * [PUB voeStartCommand](#pub-voestartcommand-operation)
  * [SUB voeDefinitionChangedNotification](#sub-voedefinitionchangednotification-operation)

## Operations

### SUB `voeReadyNotification` Operation

*Ready Notification*

* Operation ID: `voeReadyNotification`

The editor announces that it's code is loaded and initialized so the communication can start.

#### Message `voeReadyNotification`

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| metadata | string | Via this property, the editor sends the stringified metadata object defined as json-ld in the header of the html file. See [here](https://github.com/verona-interfaces/metadata/#readme) for more information. | - | - | **required** |

> Examples of payload _(generated)_

```json
{
  "metadata": "string"
}
```



### PUB `voeStartCommand` Operation

*Start Command*

* Operation ID: `voeStartCommand`

The application sends parameters for editing the unit and commands the start of user interaction.

#### Message `voeStartCommand`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| unitDefinition | string | The definition of the unit (if given) to be edited. | - | format (`byte`) | - |
| unitDefinitionType | string | This lets the editor the unit definition format know. This might avoid UI mess after getting old definitions. | - | - | - |
| editorConfig | object | - | - | - | **additional properties are allowed** |
| editorConfig.directDownloadUrl | string | After starting the editor and loading the unit definition, it might be necessary to load additional code or data from the server. This data is identified by an resource ID (usually a file name). The editor can download this resource by itself without further interaction with the host frontend. The property directDownloadUrl provides the url for download. The editor extends this url by an url separator "/" and the resource ID (uri-encoded if needed). | - | - | - |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "unitDefinition": "iqb-scripted::1.4.0 title::Testscript Title2??Hilfetext2 multiple-choice::mc_var1::1::Multiple Choice Feld: ::Choice1##Choice2##Choice3??Hilfetext1 drop-down::dd_var1::1::Dropdown Feld: ::Choice1##Choice2##Choice3??Hilfetext1 checkbox::check_var1::0::Ja klick mal! if-start::dd_var1::1 input-text::java::sap oxa if-else input-text::java_22::sap oxa U text::NOT Choice1 if-end",
  "unitDefinitionType": "iqb-scripted@1.4.0",
  "editorConfig": {
    "directDownloadUrl": "https://www.iqb-studio.de/download/iskeid-34e845-didmmemdkek"
  }
}
```



### SUB `voeDefinitionChangedNotification` Operation

*Definition Changed Notification*

* Operation ID: `voeDefinitionChangedNotification`

The definition of the unit has changed.

#### Message `voeDefinitionChangedNotification`

* Content type: [application/json](https://www.iana.org/assignments/media-types/application/json)

##### Payload

| Name | Type | Description | Value | Constraints | Notes |
|---|---|---|---|---|---|
| (root) | object | - | - | - | **additional properties are allowed** |
| sessionId | string | The session id flags all communication. If a message has no or empty session id, it's not processed. The session id is unique and was generated by the application. Any simple algorithm would work. The session id helps to link the correct unit with the data of the message. Using the id of the editor hosting html element is less reliable, because the element could be reused with another unit. | - | - | **required** |
| timeStamp | string | Ensures, that later arriving states are ignored. | - | format (`date-time`) | **required** |
| unitDefinition | string | To be stored. | - | format (`byte`) | **required** |
| unitDefinitionType | string | In order to understand the definition outside the editor, the type of the definition should be known. This helps to select a suitable player to run the unit. | - | - | **required** |
| variables | array<object> | Data structure produced by verona editors, consumed by schemer etc. | - | - | - |
| variables.id | string | Identifier for the variable | - | pattern (`^[0-9a-zA-Z_]+$`) | **required** |
| variables.type | string | Value type | allowed (`"string"`, `"integer"`, `"number"`, `"boolean"`, `"attachment"`) | - | **required** |
| variables.format | string | More specification for value type | allowed (`"text-selection"`, `"image"`, `"capture-image"`, `"audio"`, `"ggb-file"`, `"non-negative"`) | - | - |
| variables.multiple | boolean | If true, this variable can hold an array of values. | - | - | - |
| variables.nullable | boolean | If true, this variable can hold null as value. | default (`true`) | - | - |
| variables.values | array<object> | List of all known possible values with labels if given. | default (`[]`) | - | - |
| variables.values.value | oneOf | - | - | - | **required**, **additional properties are allowed** |
| variables.values.value.0 (oneOf item) | boolean | - | - | - | - |
| variables.values.value.1 (oneOf item) | number | - | - | - | - |
| variables.values.value.2 (oneOf item) | string | - | - | - | - |
| variables.values.label | string | - | - | - | - |
| variables.valuePositionLabels | array<string> | If value is of type array, there might be a fixed array length with fixed labelled positions. | default (`[]`) | - | - |
| variables.valuePositionLabels (single item) | string | - | - | non-empty | - |
| variables.valuesComplete | boolean | If true, there is not other possible value except the listed ones. | - | - | - |
| variables.page | string | Identifier of the page the variable is located on. | - | pattern (`^[0-9a-zA-Z_]*$`) | - |
| dependenciesToPlay | array<object> | Files to provide or services to keep accessible during the presentation of the unit. | - | - | - |
| dependenciesToPlay.id | string | - | - | - | **required** |
| dependenciesToPlay.type | string | - | allowed (`"file"`, `"service"`) | - | **required** |
| dependenciesToEdit | array<object> | Files to provide or services to keep accessible to enable the editing of the unit. | - | - | - |
| dependenciesToEdit.id | string | - | - | - | **required** |
| dependenciesToEdit.type | string | - | allowed (`"file"`, `"service"`) | - | **required** |

> Examples of payload _(generated)_

```json
{
  "sessionId": "idk8ur5jf9ru5jk",
  "timeStamp": "2019-08-24T14:15:22Z",
  "unitDefinition": "string",
  "unitDefinitionType": "iqb-scripted@1.4.0",
  "variables": [
    {
      "id": "string",
      "type": "string",
      "format": "text-selection",
      "multiple": false,
      "nullable": true,
      "values": [],
      "valuePositionLabels": [],
      "valuesComplete": false,
      "page": "string"
    }
  ],
  "dependenciesToPlay": [
    {
      "id": "GeoGebra.itcr.zip",
      "type": "file"
    }
  ],
  "dependenciesToEdit": [
    {
      "id": "GeoGebra.itcr.zip",
      "type": "file"
    }
  ]
}
```



